<!DOCTYPE html>

<html lang="ja" xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="UTF-8">
        <link th:href="@{/css/style.css}" rel="styleSheet">

        <title>TOP</title>
    </head>

    <body>
        <div class="header-contents">
            <h1>ToDo</h1>

            <div th:if="${errorCode}" style="color:red;" th:text="${errorCode}"></div>
            <!-- 本日の日付を表示 -->
            <div class="today-date">
                <p>本日の日付：<span th:text="${#temporals.format(T(java.time.LocalDate).now(), 'yyyy/MM/dd')}"></span></p>
            </div>

            <!-- タスクを追加するボタン -->
            <div class="btn-newtask">
                <a th:href="@{/new}">
                    <input type="button" value="新規タスク">
                </a>
            </div>

            <!-- 絞り込み機能 -->
            <div class="filter-wrap">
                <form th:method="get" action="./" th:object="${filterForm}">
                    <!-- 期限で絞り込み -->
                    <div class="filter-limit">
                        <label>期限：</label>
                        <input type="date" name="startDate" th:field="*{startDate}">
                        <span>～</span>
                        <input type="date" name="endDate" th:field="*{endDate}">
                    </div>

                    <!-- ステータスで絞り込み -->
                    <div class="filter-status">
                        <label>ステータス：</label>
                        <select name="status" th:field="*{status}">
                            <option value="0">選択なし</option>
                            <option value="1">未着手</option>
                            <option value="2">ステイ中</option>
                            <option value="3">実行中</option>
                            <option value="4">完了</option>
                        </select>
                    </div>

                    <!-- タスク内容で絞り込み -->
                    <div class="filter-content">
                        <label>タスク内容：</label>
                        <input type="text" name="searchword" th:field="*{searchword}"/>
                    </div>

                    <!-- 絞り込みボタン -->
                    <div class="filter-btn">
                        <button type="submit">絞り込み</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="main-contents">
            <!-- タスクの表示 -->
            <div class="task-list">
                <table>
                    <thead>
                        <tr>
                            <th>タスク内容</th>
                            <th>ステータス</th>
                            <th>タスク期限</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr th:each="task : ${tasks}">

                            <!-- タスク内容 -->
                            <td class="task-content" th:text="${task.content}"></td>

                            <!-- ステータス -->
                            <td>
                                <form th:action="@{/change/{id}(id=${task.id})}" th:method="put" onsubmit="return confirmChange();">
                                    <input type="hidden" name="id"/>
                                    <select class="status" name="status">
                                        <option value="1" th:selected="${task.status == 1}">未着手</option>
                                        <option value="2" th:selected="${task.status == 2}">ステイ中</option>
                                        <option value="3" th:selected="${task.status == 3}">実行中</option>
                                        <option value="4" th:selected="${task.status == 4}">完了</option>
                                    </select>

                                    <button class="button-change" type="submit">変更</button>
                                </form>
                            </td>

                            <!-- タスク期限 -->
                            <td th:class="${task.limitDate.isAfter(T(java.time.LocalDate).now())} ? 'limit-future' : 'limit-past'">
                                <span th:text="${#temporals.format(task.limitDate, 'yyyy-MM-dd')}">></span>
                            </td>

                            <!-- 編集ボタン -->
                            <td>
                                <a th:href="@{/edit/{id}(id=${task.id})}">
                                    <input class="button-edit" type="button" value="編集">
                                </a>
                            </td>

                            <!-- 削除ボタン -->
                            <td>
                                <form th:action="@{/delete/{id}(id=${task.id})}" th:method="post" onsubmit="return confirmDelete();">
                                    <input type="hidden" name="_method" value="delete"/>
                                    <input class="button-delete" type="submit" value="削除">
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            function confirmDelete() {
                return confirm("タスクを削除しますか？");
            }

            function confirmChange() {
                return confirm("ステータスを変更しますか？");
            }
        </script>
    </body>
</html>
